<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>reffadjustsim-examples â€“ reffadjust</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-5b4ad623e5705c0698d39aec6f10cf02.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="mystyles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">reffadjust</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-helpfile-examples" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Helpfile examples</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-helpfile-examples">    
        <li>
    <a class="dropdown-item" href="./reffadjust4nlcom-examples.html">
 <span class="dropdown-text">reffadjust4nlcom</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./reffadjustsim-examples.html">
 <span class="dropdown-text">reffadjustsim</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-helpfiles" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Helpfiles</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-helpfiles">    
        <li>
    <a class="dropdown-item" href="./reffadjust-helpfile.html">
 <span class="dropdown-text">reffadjust</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./reffadjust4nlcom-helpfile.html">
 <span class="dropdown-text">reffadjust4nlcom</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./reffadjustsim-helpfile.html">
 <span class="dropdown-text">reffadjustsim</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/remlapmot/reffadjust"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#example-1-two-level-continuous-response-model" id="toc-example-1-two-level-continuous-response-model" class="nav-link active" data-scroll-target="#example-1-two-level-continuous-response-model">Example 1: Two level continuous response model</a></li>
  <li><a href="#example-2-multivariate-response-model" id="toc-example-2-multivariate-response-model" class="nav-link" data-scroll-target="#example-2-multivariate-response-model">Example 2: Multivariate response model</a></li>
  <li><a href="#example-4-based-on-xtmelogit-helpfile" id="toc-example-4-based-on-xtmelogit-helpfile" class="nav-link" data-scroll-target="#example-4-based-on-xtmelogit-helpfile">Example 4: based on xtmelogit helpfile</a></li>
  <li><a href="#example-5-based-on-xtmepoisson-helpfile" id="toc-example-5-based-on-xtmepoisson-helpfile" class="nav-link" data-scroll-target="#example-5-based-on-xtmepoisson-helpfile">Example 5: based on xtmepoisson helpfile</a></li>
  <li><a href="#example-6-repeated-group-variable" id="toc-example-6-repeated-group-variable" class="nav-link" data-scroll-target="#example-6-repeated-group-variable">Example 6: repeated group variable</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">reffadjustsim helpfile examples</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Examples 1 &amp; 2 assume the path to the MLwiN executable is set in global MLwiN_path; see <code>help runmlwin</code></p>
<section id="example-1-two-level-continuous-response-model" class="level2">
<h2 class="anchored" data-anchor-id="example-1-two-level-continuous-response-model">Example 1: Two level continuous response model</h2>
<p>(see page 59 of the MLwiN User Manual)</p>
<ul>
<li>read in data</li>
</ul>
<div id="0a4edf50" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> https:<span class="co">//www.bristol.ac.uk/cmm/media/runmlwin/tutorial, clear</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>fit model using MLwiN via <code>runmlwin</code></li>
</ul>
<div id="6284fc52" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>runmlwin normexam cons standlrt, level1(student: cons) <span class="co">///</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    level2(school: cons standlrt) batch</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> 
 --- Begin MLwiN error log --- 
MLN - Software for N-level analysis.   Sat 25 Oct 2025 22:35:05

/var/folders/9j/bw4vdrw94yndry3z9cv8ms1m0000gn/T//St77659.000003

/var/folders/9j/bw4vdrw94yndry3z9cv8ms1m0000gn/T//St77659.000007
 --- End MLwiN error log --- 

Warning: getversion plugin could not be loaded
MLwiN 3.16 multilevel model                     Number of obs      =      4059
Normal response model (hierarchical)
Estimation algorithm: IGLS

-----------------------------------------------------------
                |   No. of       Observations per Group
 Level Variable |   Groups    Minimum    Average    Maximum
----------------+------------------------------------------
         school |       65          2       62.4        198
-----------------------------------------------------------

Run time (seconds)   =       0.07
Number of iterations =          4
Log likelihood       =  -4658.435
Deviance             =    9316.87
------------------------------------------------------------------------------
    normexam |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        cons |  -.0115051    .039783   -0.29    0.772    -.0894783     .066468
    standlrt |   .5567305    .019937   27.92    0.000     .5176547    .5958062
------------------------------------------------------------------------------

------------------------------------------------------------------------------
   Random-effects Parameters |   Estimate   Std. Err.     [95% Conf. Interval]
-----------------------------+------------------------------------------------
Level 2: school              |
                   var(cons) |   .0904446    .017924      .0553142    .1255749
          cov(cons,standlrt) |   .0180414   .0067229      .0048649     .031218
               var(standlrt) |   .0145361   .0044139      .0058851    .0231872
-----------------------------+------------------------------------------------
Level 1: student             |
                   var(cons) |   .5536575   .0124818      .5291937    .5781214
------------------------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/nogui option ignored
ECHO 0

Execution completed</code></pre>
</div>
</div>
<ul>
<li>report coefficient as median with 2.5 &amp; 97.5 percentiles</li>
</ul>
<div id="b030a21d" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>reffadjustsim cons standlrt, eqn(RP2) <span class="dv">seed</span>(12345)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
------------------------------------------------------------------------------
        cons |     Median              2.5 Percentile      97.5 Percentile
-------------+----------------------------------------------------------------
    standlrt |   1.242541                 .4311653            2.607229
------------------------------------------------------------------------------</code></pre>
</div>
</div>
<ul>
<li>report coefficient as mean &amp; Wald-type confidence interval</li>
<li>Warning: mean and Wald-type confidence are inaccurate in this example</li>
</ul>
<div id="2aecbcd6" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>reffadjustsim cons standlrt, eqn(RP2) <span class="dv">seed</span>(12345) waldtype</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
------------------------------------------------------------------------------
        cons |      Coef.   Std. Err.                     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    standlrt |   1.319134    1.22225                     -1.076431      3.7147
------------------------------------------------------------------------------
Warning: Coef. &amp; Wald-type conf. interval limits may be inaccurate.
Please compare with default output which reports median &amp; centiles.</code></pre>
</div>
</div>
<ul>
<li>compare with delta-method confidence interval (first refit model)</li>
</ul>
<div id="b0c88691" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>runmlwin normexam cons standlrt, level1(student: cons) <span class="co">///</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    level2(school: cons standlrt) batch</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>reffadjust4nlcom cons standlrt, eqn(RP2)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">nlcom</span> <span class="ot">`r(beta_standlrt)'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> 
 --- Begin MLwiN error log --- 
MLN - Software for N-level analysis.   Sat 25 Oct 2025 22:35:05

/var/folders/9j/bw4vdrw94yndry3z9cv8ms1m0000gn/T//St77659.000004

/var/folders/9j/bw4vdrw94yndry3z9cv8ms1m0000gn/T//St77659.000008
 --- End MLwiN error log --- 

Warning: getversion plugin could not be loaded
MLwiN 3.16 multilevel model                     Number of obs      =      4059
Normal response model (hierarchical)
Estimation algorithm: IGLS

-----------------------------------------------------------
                |   No. of       Observations per Group
 Level Variable |   Groups    Minimum    Average    Maximum
----------------+------------------------------------------
         school |       65          2       62.4        198
-----------------------------------------------------------

Run time (seconds)   =       0.04
Number of iterations =          4
Log likelihood       =  -4658.435
Deviance             =    9316.87
------------------------------------------------------------------------------
    normexam |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        cons |  -.0115051    .039783   -0.29    0.772    -.0894783     .066468
    standlrt |   .5567305    .019937   27.92    0.000     .5176547    .5958062
------------------------------------------------------------------------------

------------------------------------------------------------------------------
   Random-effects Parameters |   Estimate   Std. Err.     [95% Conf. Interval]
-----------------------------+------------------------------------------------
Level 2: school              |
                   var(cons) |   .0904446    .017924      .0553142    .1255749
          cov(cons,standlrt) |   .0180414   .0067229      .0048649     .031218
               var(standlrt) |   .0145361   .0044139      .0058851    .0231872
-----------------------------+------------------------------------------------
Level 1: student             |
                   var(cons) |   .5536575   .0124818      .5291937    .5781214
------------------------------------------------------------------------------

       _nl_1: [RP2]cov(cons\standlrt)/[RP2]var(standlrt)

------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
       _nl_1 |   1.241144   .4275471     2.90   0.004     .4031675    2.079121
------------------------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/nogui option ignored
ECHO 0

Execution completed</code></pre>
</div>
</div>
<ul>
<li>compare with Bayesian posterior distribution</li>
</ul>
<div id="89a3201c" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>runmlwin normexam cons standlrt, level1(student: cons) <span class="co">///</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    level2(school: cons standlrt) batch mcmc(<span class="kw">on</span>) initsprevious <span class="dv">seed</span>(121211)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>mcmcsum, getchains</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>reffadjustsim cons standlrt, eqn(RP2) mcmcsum</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/nogui option ignored
ECHO 0

BURNING IN...
Burning in for 50 iterations out of 500
Burning in for 100 iterations out of 500
Burning in for 150 iterations out of 500
Burning in for 200 iterations out of 500
Burning in for 250 iterations out of 500
Burning in for 300 iterations out of 500
Burning in for 350 iterations out of 500
Burning in for 400 iterations out of 500
Burning in for 450 iterations out of 500
Burning in for 500 iterations out of 500

Actual update 50 of 5000, Stored update 50 of 5000
Actual update 100 of 5000, Stored update 100 of 5000
Actual update 150 of 5000, Stored update 150 of 5000
Actual update 200 of 5000, Stored update 200 of 5000
Actual update 250 of 5000, Stored update 250 of 5000
Actual update 300 of 5000, Stored update 300 of 5000
Actual update 350 of 5000, Stored update 350 of 5000
Actual update 400 of 5000, Stored update 400 of 5000
Actual update 450 of 5000, Stored update 450 of 5000
Actual update 500 of 5000, Stored update 500 of 5000
Actual update 550 of 5000, Stored update 550 of 5000
Actual update 600 of 5000, Stored update 600 of 5000
Actual update 650 of 5000, Stored update 650 of 5000
Actual update 700 of 5000, Stored update 700 of 5000
Actual update 750 of 5000, Stored update 750 of 5000
Actual update 800 of 5000, Stored update 800 of 5000
Actual update 850 of 5000, Stored update 850 of 5000
Actual update 900 of 5000, Stored update 900 of 5000
Actual update 950 of 5000, Stored update 950 of 5000
Actual update 1000 of 5000, Stored update 1000 of 5000
Actual update 1050 of 5000, Stored update 1050 of 5000
Actual update 1100 of 5000, Stored update 1100 of 5000
Actual update 1150 of 5000, Stored update 1150 of 5000
Actual update 1200 of 5000, Stored update 1200 of 5000
Actual update 1250 of 5000, Stored update 1250 of 5000
Actual update 1300 of 5000, Stored update 1300 of 5000
Actual update 1350 of 5000, Stored update 1350 of 5000
Actual update 1400 of 5000, Stored update 1400 of 5000
Actual update 1450 of 5000, Stored update 1450 of 5000
Actual update 1500 of 5000, Stored update 1500 of 5000
Actual update 1550 of 5000, Stored update 1550 of 5000
Actual update 1600 of 5000, Stored update 1600 of 5000
Actual update 1650 of 5000, Stored update 1650 of 5000
Actual update 1700 of 5000, Stored update 1700 of 5000
Actual update 1750 of 5000, Stored update 1750 of 5000
Actual update 1800 of 5000, Stored update 1800 of 5000
Actual update 1850 of 5000, Stored update 1850 of 5000
Actual update 1900 of 5000, Stored update 1900 of 5000
Actual update 1950 of 5000, Stored update 1950 of 5000
Actual update 2000 of 5000, Stored update 2000 of 5000
Actual update 2050 of 5000, Stored update 2050 of 5000
Actual update 2100 of 5000, Stored update 2100 of 5000
Actual update 2150 of 5000, Stored update 2150 of 5000
Actual update 2200 of 5000, Stored update 2200 of 5000
Actual update 2250 of 5000, Stored update 2250 of 5000
Actual update 2300 of 5000, Stored update 2300 of 5000
Actual update 2350 of 5000, Stored update 2350 of 5000
Actual update 2400 of 5000, Stored update 2400 of 5000
Actual update 2450 of 5000, Stored update 2450 of 5000
Actual update 2500 of 5000, Stored update 2500 of 5000
Actual update 2550 of 5000, Stored update 2550 of 5000
Actual update 2600 of 5000, Stored update 2600 of 5000
Actual update 2650 of 5000, Stored update 2650 of 5000
Actual update 2700 of 5000, Stored update 2700 of 5000
Actual update 2750 of 5000, Stored update 2750 of 5000
Actual update 2800 of 5000, Stored update 2800 of 5000
Actual update 2850 of 5000, Stored update 2850 of 5000
Actual update 2900 of 5000, Stored update 2900 of 5000
Actual update 2950 of 5000, Stored update 2950 of 5000
Actual update 3000 of 5000, Stored update 3000 of 5000
Actual update 3050 of 5000, Stored update 3050 of 5000
Actual update 3100 of 5000, Stored update 3100 of 5000
Actual update 3150 of 5000, Stored update 3150 of 5000
Actual update 3200 of 5000, Stored update 3200 of 5000
Actual update 3250 of 5000, Stored update 3250 of 5000
Actual update 3300 of 5000, Stored update 3300 of 5000
Actual update 3350 of 5000, Stored update 3350 of 5000
Actual update 3400 of 5000, Stored update 3400 of 5000
Actual update 3450 of 5000, Stored update 3450 of 5000
Actual update 3500 of 5000, Stored update 3500 of 5000
Actual update 3550 of 5000, Stored update 3550 of 5000
Actual update 3600 of 5000, Stored update 3600 of 5000
Actual update 3650 of 5000, Stored update 3650 of 5000
Actual update 3700 of 5000, Stored update 3700 of 5000
Actual update 3750 of 5000, Stored update 3750 of 5000
Actual update 3800 of 5000, Stored update 3800 of 5000
Actual update 3850 of 5000, Stored update 3850 of 5000
Actual update 3900 of 5000, Stored update 3900 of 5000
Actual update 3950 of 5000, Stored update 3950 of 5000
Actual update 4000 of 5000, Stored update 4000 of 5000
Actual update 4050 of 5000, Stored update 4050 of 5000
Actual update 4100 of 5000, Stored update 4100 of 5000
Actual update 4150 of 5000, Stored update 4150 of 5000
Actual update 4200 of 5000, Stored update 4200 of 5000
Actual update 4250 of 5000, Stored update 4250 of 5000
Actual update 4300 of 5000, Stored update 4300 of 5000
Actual update 4350 of 5000, Stored update 4350 of 5000
Actual update 4400 of 5000, Stored update 4400 of 5000
Actual update 4450 of 5000, Stored update 4450 of 5000</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> --- Begin MLwiN error log --- 
MLN - Software for N-level analysis.   Sat 25 Oct 2025 22:35:05

/var/folders/9j/bw4vdrw94yndry3z9cv8ms1m0000gn/T//St77659.000006

/var/folders/9j/bw4vdrw94yndry3z9cv8ms1m0000gn/T//St77659.00000a

/var/folders/9j/bw4vdrw94yndry3z9cv8ms1m0000gn/T//St77659.000004
 --- End MLwiN error log --- 
</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Actual update 4500 of 5000, Stored update 4500 of 5000
Actual update 4550 of 5000, Stored update 4550 of 5000
Actual update 4600 of 5000, Stored update 4600 of 5000
Actual update 4650 of 5000, Stored update 4650 of 5000
Actual update 4700 of 5000, Stored update 4700 of 5000
Actual update 4750 of 5000, Stored update 4750 of 5000
Actual update 4800 of 5000, Stored update 4800 of 5000
Actual update 4850 of 5000, Stored update 4850 of 5000
Actual update 4900 of 5000, Stored update 4900 of 5000
Actual update 4950 of 5000, Stored update 4950 of 5000
Actual update 5000 of 5000, Stored update 5000 of 5000
Execution completed</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: getversion plugin could not be loaded
MLwiN 3.16 multilevel model                     Number of obs      =      4059
Normal response model (hierarchical)
Estimation algorithm: MCMC

-----------------------------------------------------------
                |   No. of       Observations per Group
 Level Variable |   Groups    Minimum    Average    Maximum
----------------+------------------------------------------
         school |       65          2       62.4        198
-----------------------------------------------------------

Burnin                     =        500
Chain                      =       5000
Thinning                   =          1
Run time (seconds)         =       .605
Deviance (dbar)            =    9122.42
Deviance (thetabar)        =    9031.09
Effective no. of pars (pd) =      91.34
Bayesian DIC               =    9213.76
------------------------------------------------------------------------------
    normexam |      Mean    Std. Dev.     ESS     P       [95% Cred. Interval]
-------------+----------------------------------------------------------------
        cons |   -.010594    .040224      189   0.395    -.0908355    .0678323
    standlrt |   .5568075   .0200344      839   0.000     .5167302    .5960792
------------------------------------------------------------------------------

------------------------------------------------------------------------------
   Random-effects Parameters |     Mean   Std. Dev.   ESS     [95% Cred. Int]
-----------------------------+------------------------------------------------
Level 2: school              |
                   var(cons) |  .0961163  .0199991   2715   .0644542  .1421674
          cov(cons,standlrt) |  .0190683  .0072205   1713   .0065699   .034989
               var(standlrt) |  .0153485  .0046893    978   .0078805  .0261361
-----------------------------+------------------------------------------------
Level 1: student             |
                   var(cons) |  .5542075  .0123209   4645   .5309043   .578929
------------------------------------------------------------------------------

------------------------------------------------------------------------------
        cons |     Median              2.5 Percentile      97.5 Percentile
-------------+----------------------------------------------------------------
    standlrt |   1.266334                 .4572121            2.281147
------------------------------------------------------------------------------</code></pre>
</div>
</div>
</section>
<section id="example-2-multivariate-response-model" class="level2">
<h2 class="anchored" data-anchor-id="example-2-multivariate-response-model">Example 2: Multivariate response model</h2>
<p>(see page 214 of the MLwiN User Manual)</p>
<ul>
<li>read in data</li>
</ul>
<div id="e8351103" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> https:<span class="co">//www.bristol.ac.uk/cmm/media/runmlwin/gcsemv1, clear</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>fit model using MLwiN via <code>runmlwin</code></li>
</ul>
<div id="8f230af3" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>runmlwin (written cons female, <span class="kw">eq</span>(1)) (csework cons female, <span class="kw">eq</span>(2)), <span class="co">///</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>        level1(student: (cons, <span class="kw">eq</span>(1)) (cons, <span class="kw">eq</span>(2))) <span class="co">///</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>        level2(school: (cons, <span class="kw">eq</span>(1)) (cons, <span class="kw">eq</span>(2))) <span class="co">///</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>        batch</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> 
 --- Begin MLwiN error log --- 
MLN - Software for N-level analysis.   Sat 25 Oct 2025 22:35:06

/var/folders/9j/bw4vdrw94yndry3z9cv8ms1m0000gn/T//St77659.000005

/var/folders/9j/bw4vdrw94yndry3z9cv8ms1m0000gn/T//St77659.000009

/var/folders/9j/bw4vdrw94yndry3z9cv8ms1m0000gn/T//St77659.00000a
 --- End MLwiN error log --- 

Warning: getversion plugin could not be loaded
MLwiN 3.16 multilevel model                     Number of obs      =      1905
Multivariate response model (hierarchical)
Estimation algorithm: IGLS

-----------------------------------------------------------
                |   No. of       Observations per Group
 Level Variable |   Groups    Minimum    Average    Maximum
----------------+------------------------------------------
         school |       73          2       26.1        104
-----------------------------------------------------------

Run time (seconds)   =       0.10
Number of iterations =          4
Log likelihood       = -13400.244
Deviance             =  26800.488
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
written      |
      cons_1 |   49.45213   .9338433   52.96    0.000     47.62183    51.28243
    female_1 |   -2.50295   .5607219   -4.46    0.000    -3.601945   -1.403955
-------------+----------------------------------------------------------------
csework      |
      cons_2 |   69.67166   1.171786   59.46    0.000       67.375    71.96831
    female_2 |   6.751393   .6706493   10.07    0.000     5.436944    8.065841
------------------------------------------------------------------------------

------------------------------------------------------------------------------
   Random-effects Parameters |   Estimate   Std. Err.     [95% Conf. Interval]
-----------------------------+------------------------------------------------
Level 2: school              |
                 var(cons_1) |   46.81298    9.18733      28.80615    64.81982
          cov(cons_1,cons_2) |   24.87783   8.880358       7.47265    42.28301
                 var(cons_2) |   75.16623   14.56485      46.61965    103.7128
-----------------------------+------------------------------------------------
Level 1: student             |
                 var(cons_1) |   124.6343   4.349834      116.1088    133.1598
          cov(cons_1,cons_2) |   73.00323    4.17829      64.81393    81.19252
                 var(cons_2) |   180.0982   6.245801      167.8566    192.3397
------------------------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/nogui option ignored
ECHO 0

Execution completed</code></pre>
</div>
</div>
<ul>
<li>report coefficient as median with 2.5 and 97.5 percentiles</li>
</ul>
<div id="183e8076" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>reffadjustsim cons_1 cons_2, eqn(RP2) <span class="dv">seed</span>(12345)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
------------------------------------------------------------------------------
      cons_1 |     Median              2.5 Percentile      97.5 Percentile
-------------+----------------------------------------------------------------
      cons_2 |   .3308853                 .1231026            .5395364
------------------------------------------------------------------------------</code></pre>
</div>
</div>
<ul>
<li>report coefficient as mean with Wald-type confidence interval</li>
</ul>
<div id="efeefb06" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>reffadjustsim cons_1 cons_2, eqn(RP2) <span class="dv">seed</span>(12345) waldtype</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
------------------------------------------------------------------------------
      cons_1 |      Coef.   Std. Err.                     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      cons_2 |    .330939   .1065639                      .1220777    .5398003
------------------------------------------------------------------------------
Warning: Coef. &amp; Wald-type conf. interval limits may be inaccurate.
Please compare with default output which reports median &amp; centiles.</code></pre>
</div>
</div>
<ul>
<li>compare with delta-method confidence interval (first refit model)</li>
</ul>
<div id="8bfba89a" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>runmlwin (written cons female, <span class="kw">eq</span>(1)) (csework cons female, <span class="kw">eq</span>(2)), <span class="co">///</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>        level1(student: (cons, <span class="kw">eq</span>(1)) (cons, <span class="kw">eq</span>(2))) <span class="co">///</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>        level2(school: (cons, <span class="kw">eq</span>(1)) (cons, <span class="kw">eq</span>(2))) <span class="co">///</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>        batch</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>reffadjust4nlcom cons_1 cons_2, eqn(RP2)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="kw">nlcom</span> <span class="ot">`r(beta_cons_2)'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> 
 --- Begin MLwiN error log --- 
MLN - Software for N-level analysis.   Sat 25 Oct 2025 22:35:06

/var/folders/9j/bw4vdrw94yndry3z9cv8ms1m0000gn/T//St77659.000006

/var/folders/9j/bw4vdrw94yndry3z9cv8ms1m0000gn/T//St77659.00000a

/var/folders/9j/bw4vdrw94yndry3z9cv8ms1m0000gn/T//St77659.00000b
 --- End MLwiN error log --- 

Warning: getversion plugin could not be loaded
MLwiN 3.16 multilevel model                     Number of obs      =      1905
Multivariate response model (hierarchical)
Estimation algorithm: IGLS

-----------------------------------------------------------
                |   No. of       Observations per Group
 Level Variable |   Groups    Minimum    Average    Maximum
----------------+------------------------------------------
         school |       73          2       26.1        104
-----------------------------------------------------------

Run time (seconds)   =       0.10
Number of iterations =          4
Log likelihood       = -13400.244
Deviance             =  26800.488
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
written      |
      cons_1 |   49.45213   .9338433   52.96    0.000     47.62183    51.28243
    female_1 |   -2.50295   .5607219   -4.46    0.000    -3.601945   -1.403955
-------------+----------------------------------------------------------------
csework      |
      cons_2 |   69.67166   1.171786   59.46    0.000       67.375    71.96831
    female_2 |   6.751393   .6706493   10.07    0.000     5.436944    8.065841
------------------------------------------------------------------------------

------------------------------------------------------------------------------
   Random-effects Parameters |   Estimate   Std. Err.     [95% Conf. Interval]
-----------------------------+------------------------------------------------
Level 2: school              |
                 var(cons_1) |   46.81298    9.18733      28.80615    64.81982
          cov(cons_1,cons_2) |   24.87783   8.880358       7.47265    42.28301
                 var(cons_2) |   75.16623   14.56485      46.61965    103.7128
-----------------------------+------------------------------------------------
Level 1: student             |
                 var(cons_1) |   124.6343   4.349834      116.1088    133.1598
          cov(cons_1,cons_2) |   73.00323    4.17829      64.81393    81.19252
                 var(cons_2) |   180.0982   6.245801      167.8566    192.3397
------------------------------------------------------------------------------

       _nl_1: [RP2]cov(cons_1\cons_2)/[RP2]var(cons_2)

------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
       _nl_1 |   .3309709   .0986417     3.36   0.001     .1376367    .5243051
------------------------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/nogui option ignored
ECHO 0

Execution completed</code></pre>
</div>
</div>
<ul>
<li>compare with Bayesian posterior distribution</li>
</ul>
<p>runmlwin (written cons female, eq(1)) (csework cons female, eq(2)), /// level1(student: (cons, eq(1)) (cons, eq(2))) /// level2(school: (cons, eq(1)) (cons, eq(2))) /// batch mcmc(on) initsprevious seed(121211) mcmcsum, getchains reffadjustsim cons_1 cons_2, eqn(RP2) mcmcsum</p>
<pre><code>
## Example 3: based on xtmixed helpfile

::: {#93f34de6 .cell execution_count=13}
``` {.stata .cell-code}
webuse nlswork, clear
version 12: xtmixed ln_w grade age c.age#c.age ttl_exp tenure c.tenure#c.tenure || ///
    idcode: tenure, cov(uns) var
version 12: reffadjustsim _cons tenure, eqn(idcode) seed(12345)</code></pre>
<div class="cell-output cell-output-stdout">
<pre><code>(National Longitudinal Survey of Young Women, 14-24 years old in 1968)

Performing EM optimization: 

Performing gradient-based optimization: 

Iteration 0:  Log likelihood = -8985.3816  
Iteration 1:  Log likelihood = -8966.2878  
Iteration 2:  Log likelihood =  -8965.819  
Iteration 3:  Log likelihood =  -8965.819  

Computing standard errors:

Mixed-effects ML regression                         Number of obs    =  28,099
Group variable: idcode                              Number of groups =   4,697
                                                    Obs per group:
                                                                 min =       1
                                                                 avg =     6.0
                                                                 max =      15
                                                    Wald chi2(6)     = 6767.13
Log likelihood =  -8965.819                         Prob &gt; chi2      =  0.0000

------------------------------------------------------------------------------
     ln_wage | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
       grade |   .0690318   .0017885    38.60   0.000     .0655264    .0725372
         age |   .0321872   .0027908    11.53   0.000     .0267174     .037657
             |
 c.age#c.age |  -.0006574   .0000466   -14.09   0.000    -.0007488    -.000566
             |
     ttl_exp |   .0350762   .0011352    30.90   0.000     .0328513     .037301
      tenure |   .0393576   .0017198    22.88   0.000     .0359868    .0427284
             |
    c.tenure#|
    c.tenure |  -.0019926   .0001232   -16.18   0.000    -.0022341   -.0017512
             |
       _cons |    .162264    .044888     3.61   0.000     .0742851    .2502429
------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
idcode: Unstructured         |
                 var(tenure) |   .0005174   .0000566      .0004176    .0006411
                  var(_cons) |   .0632497   .0020808      .0593001    .0674624
           cov(tenure,_cons) |   .0007165   .0002809      .0001658    .0012671
-----------------------------+------------------------------------------------
               var(Residual) |   .0815016   .0007978      .0799529    .0830803
------------------------------------------------------------------------------
LR test vs. linear model: chi2(3) = 9168.36               Prob &gt; chi2 = 0.0000

Note: LR test is conservative and provided only for reference.

------------------------------------------------------------------------------
       _cons |     Median              2.5 Percentile      97.5 Percentile
-------------+----------------------------------------------------------------
      tenure |   1.377053                 .2240176            2.619103
------------------------------------------------------------------------------</code></pre>
</div>
<p>:::</p>
<div id="f77b81c8" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>mixed ln_w grade age c.age#c.age ttl_exp tenure c.tenure#c.tenure || <span class="co">///</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    idcode: tenure, cov(uns)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>reffadjustsim <span class="dt">_cons</span> tenure, eqn(idcode) <span class="dv">seed</span>(12345)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Performing EM optimization ...

Performing gradient-based optimization: 
Iteration 0:  Log likelihood = -8985.3816  
Iteration 1:  Log likelihood = -8966.3961  
Iteration 2:  Log likelihood =  -8965.819  
Iteration 3:  Log likelihood =  -8965.819  

Computing standard errors ...

Mixed-effects ML regression                         Number of obs    =  28,099
Group variable: idcode                              Number of groups =   4,697
                                                    Obs per group:
                                                                 min =       1
                                                                 avg =     6.0
                                                                 max =      15
                                                    Wald chi2(6)     = 6767.13
Log likelihood =  -8965.819                         Prob &gt; chi2      =  0.0000

------------------------------------------------------------------------------
     ln_wage | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
       grade |   .0690318   .0017885    38.60   0.000     .0655264    .0725372
         age |   .0321872   .0027908    11.53   0.000     .0267174     .037657
             |
 c.age#c.age |  -.0006574   .0000466   -14.09   0.000    -.0007488    -.000566
             |
     ttl_exp |   .0350762   .0011352    30.90   0.000     .0328513     .037301
      tenure |   .0393576   .0017198    22.88   0.000     .0359868    .0427284
             |
    c.tenure#|
    c.tenure |  -.0019926   .0001232   -16.18   0.000    -.0022341   -.0017512
             |
       _cons |    .162264    .044888     3.61   0.000     .0742851    .2502429
------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
idcode: Unstructured         |
                 var(tenure) |   .0005174   .0000566      .0004176    .0006411
                  var(_cons) |   .0632497   .0020808      .0593001    .0674624
           cov(tenure,_cons) |   .0007165   .0002809      .0001658    .0012671
-----------------------------+------------------------------------------------
               var(Residual) |   .0815016   .0007978      .0799529    .0830803
------------------------------------------------------------------------------
LR test vs. linear model: chi2(3) = 9168.36               Prob &gt; chi2 = 0.0000

Note: LR test is conservative and provided only for reference.

------------------------------------------------------------------------------
       _cons |     Median              2.5 Percentile      97.5 Percentile
-------------+----------------------------------------------------------------
      tenure |   1.377053                  .224019            2.619103
------------------------------------------------------------------------------</code></pre>
</div>
</div>
</section>
<section id="example-4-based-on-xtmelogit-helpfile" class="level2">
<h2 class="anchored" data-anchor-id="example-4-based-on-xtmelogit-helpfile">Example 4: based on xtmelogit helpfile</h2>
<div id="3b783c8a" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">webuse</span> bangladesh, <span class="kw">clear</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 12: xtmelogit c_use urban age child* || district: urban , <span class="co">///</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    cov(uns) <span class="kw">var</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 12: reffadjustsim <span class="dt">_cons</span> urban, eqn(district) <span class="dv">seed</span>(12345)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Bangladesh Fertility Survey, 1989)
note: children omitted because of collinearity.

Refining starting values: 

Iteration 0:  Log likelihood = -1215.8594  (not concave)
Iteration 1:  Log likelihood = -1204.0802  
Iteration 2:  Log likelihood = -1199.7968  

Performing gradient-based optimization: 

Iteration 0:  Log likelihood = -1199.7968  
Iteration 1:  Log likelihood = -1199.4726  
Iteration 2:  Log likelihood = -1199.3158  
Iteration 3:  Log likelihood =  -1199.315  
Iteration 4:  Log likelihood =  -1199.315  

Mixed-effects logistic regression               Number of obs     =      1,934
Group variable: district                        Number of groups  =         60

                                                Obs per group:
                                                              min =          2
                                                              avg =       32.2
                                                              max =        118

Integration points =   7                        Wald chi2(5)      =      97.50
Log likelihood =  -1199.315                     Prob &gt; chi2       =     0.0000

------------------------------------------------------------------------------
       c_use | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
       urban |   .8157872   .1715519     4.76   0.000     .4795516    1.152023
         age |   -.026415    .008023    -3.29   0.001    -.0421398   -.0106902
      child1 |    1.13252   .1603285     7.06   0.000      .818282    1.446758
      child2 |   1.357739   .1770522     7.67   0.000     1.010724    1.704755
      child3 |   1.353827   .1828801     7.40   0.000     .9953882    1.712265
    children |          0  (omitted)
       _cons |   -1.71165   .1605617   -10.66   0.000    -2.026345   -1.396954
------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
district: Unstructured       |
                  var(urban) |   .6663221   .3224714      .2580709      1.7204
                  var(_cons) |   .3897434   .1292458      .2034723    .7465387
            cov(urban,_cons) |  -.4058846   .1755418     -.7499402   -.0618289
------------------------------------------------------------------------------
LR test vs. logistic model: chi2(3) = 58.42               Prob &gt; chi2 = 0.0000

Note: LR test is conservative and provided only for reference.

------------------------------------------------------------------------------
       _cons |     Median              2.5 Percentile      97.5 Percentile
-------------+----------------------------------------------------------------
       urban |  -.5931825                -.9623632           -.2892334
------------------------------------------------------------------------------</code></pre>
</div>
</div>
<div id="ce6b3466" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">webuse</span> bangladesh, <span class="kw">clear</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>meqrlogit c_use urban age child* || district: urban, cov(uns)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>reffadjustsim <span class="dt">_cons</span> urban, eqn(district) <span class="dv">seed</span>(12345)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Bangladesh Fertility Survey, 1989)
note: children omitted because of collinearity.

Refining starting values: 

Iteration 0:  Log likelihood = -1215.8594  (not concave)
Iteration 1:  Log likelihood = -1204.0802  
Iteration 2:  Log likelihood = -1199.7968  

Performing gradient-based optimization: 

Iteration 0:  Log likelihood = -1199.7968  
Iteration 1:  Log likelihood = -1199.4726  
Iteration 2:  Log likelihood = -1199.3158  
Iteration 3:  Log likelihood =  -1199.315  
Iteration 4:  Log likelihood =  -1199.315  

Mixed-effects logistic regression               Number of obs     =      1,934
Group variable: district                        Number of groups  =         60

                                                Obs per group:
                                                              min =          2
                                                              avg =       32.2
                                                              max =        118

Integration points =   7                        Wald chi2(5)      =      97.50
Log likelihood =  -1199.315                     Prob &gt; chi2       =     0.0000

------------------------------------------------------------------------------
       c_use | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
       urban |   .8157872   .1715519     4.76   0.000     .4795516    1.152023
         age |   -.026415    .008023    -3.29   0.001    -.0421398   -.0106902
      child1 |    1.13252   .1603285     7.06   0.000      .818282    1.446758
      child2 |   1.357739   .1770522     7.67   0.000     1.010724    1.704755
      child3 |   1.353827   .1828801     7.40   0.000     .9953882    1.712265
    children |          0  (omitted)
       _cons |   -1.71165   .1605617   -10.66   0.000    -2.026345   -1.396954
------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
district: Unstructured       |
                  var(urban) |   .6663221   .3224714      .2580709      1.7204
                  var(_cons) |   .3897434   .1292458      .2034723    .7465387
            cov(urban,_cons) |  -.4058846   .1755418     -.7499402   -.0618289
------------------------------------------------------------------------------
LR test vs. logistic model: chi2(3) = 58.42               Prob &gt; chi2 = 0.0000

Note: LR test is conservative and provided only for reference.

------------------------------------------------------------------------------
       _cons |     Median              2.5 Percentile      97.5 Percentile
-------------+----------------------------------------------------------------
       urban |  -.5931825                -.9623632           -.2892334
------------------------------------------------------------------------------</code></pre>
</div>
</div>
</section>
<section id="example-5-based-on-xtmepoisson-helpfile" class="level2">
<h2 class="anchored" data-anchor-id="example-5-based-on-xtmepoisson-helpfile">Example 5: based on xtmepoisson helpfile</h2>
<div id="d9d5fbdc" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">webuse</span> epilepsy, <span class="kw">clear</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 12: xtmepoisson seizures treat lbas lbas_trt lage visit || <span class="co">///</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>        subject: visit, cov(uns) <span class="kw">var</span> <span class="kw">intpoints</span>(9)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 12: reffadjustsim <span class="dt">_cons</span> visit, eqn(subject) <span class="dv">seed</span>(12345)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Epilepsy data; progabide drug treatment)

Refining starting values: 

Iteration 0:  Log likelihood = -672.17188  (not concave)
Iteration 1:  Log likelihood = -660.46056  
Iteration 2:  Log likelihood = -655.86888  

Performing gradient-based optimization: 

Iteration 0:  Log likelihood = -655.86888  
Iteration 1:  Log likelihood = -655.68217  
Iteration 2:  Log likelihood = -655.68103  
Iteration 3:  Log likelihood = -655.68103  

Mixed-effects Poisson regression                Number of obs     =        236
Group variable: subject                         Number of groups  =         59

                                                Obs per group:
                                                              min =          4
                                                              avg =        4.0
                                                              max =          4

Integration points =   9                        Wald chi2(5)      =     115.56
Log likelihood = -655.68103                     Prob &gt; chi2       =     0.0000

------------------------------------------------------------------------------
    seizures | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
       treat |  -.9286588   .4021638    -2.31   0.021    -1.716885   -.1404323
        lbas |   .8849767   .1312519     6.74   0.000     .6277277    1.142226
    lbas_trt |   .3379757   .2044442     1.65   0.098    -.0627276     .738679
        lage |   .4767192    .353622     1.35   0.178    -.2163672    1.169806
       visit |  -.2664098   .1647096    -1.62   0.106    -.5892347    .0564151
       _cons |   2.099555   .2203709     9.53   0.000     1.667636    2.531474
------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
subject: Unstructured        |
                  var(visit) |   .5314808   .2293851      .2280931    1.238406
                  var(_cons) |   .2514928   .0587892      .1590552    .3976522
            cov(visit,_cons) |   .0028715   .0887018     -.1709808    .1767238
------------------------------------------------------------------------------
LR test vs. Poisson model: chi2(3) = 324.54               Prob &gt; chi2 = 0.0000

Note: LR test is conservative and provided only for reference.

------------------------------------------------------------------------------
       _cons |     Median              2.5 Percentile      97.5 Percentile
-------------+----------------------------------------------------------------
       visit |   .0044339                -.3128618            .3397986
------------------------------------------------------------------------------</code></pre>
</div>
</div>
<div id="f24f10f5" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>meqrpoisson seizures treat lbas lbas_trt lage visit || subject: visit, <span class="co">///</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>        cov(uns) <span class="kw">intpoints</span>(9)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>reffadjustsim <span class="dt">_cons</span> visit, eqn(subject) <span class="dv">seed</span>(12345)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Refining starting values: 

Iteration 0:  Log likelihood = -672.17188  (not concave)
Iteration 1:  Log likelihood = -660.46056  
Iteration 2:  Log likelihood = -655.86888  

Performing gradient-based optimization: 

Iteration 0:  Log likelihood = -655.86888  
Iteration 1:  Log likelihood = -655.68217  
Iteration 2:  Log likelihood = -655.68103  
Iteration 3:  Log likelihood = -655.68103  

Mixed-effects Poisson regression                Number of obs     =        236
Group variable: subject                         Number of groups  =         59

                                                Obs per group:
                                                              min =          4
                                                              avg =        4.0
                                                              max =          4

Integration points =   9                        Wald chi2(5)      =     115.56
Log likelihood = -655.68103                     Prob &gt; chi2       =     0.0000

------------------------------------------------------------------------------
    seizures | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
       treat |  -.9286588   .4021638    -2.31   0.021    -1.716885   -.1404323
        lbas |   .8849767   .1312519     6.74   0.000     .6277277    1.142226
    lbas_trt |   .3379757   .2044442     1.65   0.098    -.0627276     .738679
        lage |   .4767192    .353622     1.35   0.178    -.2163672    1.169806
       visit |  -.2664098   .1647096    -1.62   0.106    -.5892347    .0564151
       _cons |   2.099555   .2203709     9.53   0.000     1.667636    2.531474
------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
subject: Unstructured        |
                  var(visit) |   .5314808   .2293851      .2280931    1.238406
                  var(_cons) |   .2514928   .0587892      .1590552    .3976522
            cov(visit,_cons) |   .0028715   .0887018     -.1709808    .1767238
------------------------------------------------------------------------------
LR test vs. Poisson model: chi2(3) = 324.54               Prob &gt; chi2 = 0.0000

Note: LR test is conservative and provided only for reference.

------------------------------------------------------------------------------
       _cons |     Median              2.5 Percentile      97.5 Percentile
-------------+----------------------------------------------------------------
       visit |   .0044339                -.3128618            .3397986
------------------------------------------------------------------------------</code></pre>
</div>
</div>
</section>
<section id="example-6-repeated-group-variable" class="level2">
<h2 class="anchored" data-anchor-id="example-6-repeated-group-variable">Example 6: repeated group variable</h2>
<div id="73aef662" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">webuse</span> nlswork, <span class="kw">clear</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 12: <span class="kw">xtmixed</span> ln_w grade age || idcode: tenure <span class="kw">union</span>, cov(uns) || <span class="co">///</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    idcode: race, cov(uns) <span class="kw">var</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 12: reffadjustsim tenure <span class="kw">union</span>, eqn(idcode) sub(1) <span class="dv">seed</span>(12345)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="kw">version</span> 12: reffadjustsim race <span class="dt">_cons</span>, eqn(idcode) sub(2) <span class="dv">seed</span>(12345)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(National Longitudinal Survey of Young Women, 14-24 years old in 1968)

Performing EM optimization: 

Performing gradient-based optimization: 

Iteration 0:  Log likelihood = -5208.9293  
Iteration 1:  Log likelihood = -5196.8989  (not concave)
Iteration 2:  Log likelihood = -5176.1013  
Iteration 3:  Log likelihood = -5174.4196  
Iteration 4:  Log likelihood = -5171.2001  
Iteration 5:  Log likelihood = -5171.0595  
Iteration 6:  Log likelihood = -5171.0493  
Iteration 7:  Log likelihood = -5171.0492  

Computing standard errors:

Mixed-effects ML regression                         Number of obs    =  19,008
Group variable: idcode                              Number of groups =   4,132
                                                    Obs per group:
                                                                 min =       1
                                                                 avg =     4.6
                                                                 max =      12
                                                    Wald chi2(2)     = 2164.18
Log likelihood = -5171.0492                         Prob &gt; chi2      =  0.0000

------------------------------------------------------------------------------
     ln_wage | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
       grade |    .083625   .0022067    37.90   0.000        .0793      .08795
         age |   .0104518   .0004215    24.80   0.000     .0096256    .0112779
       _cons |   .2739857   .0306868     8.93   0.000     .2138407    .3341308
------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
idcode: Unstructured         |
                 var(tenure) |   .0007758   .0000666      .0006556    .0009181
                  var(union) |   .0514475   .0041886      .0438594    .0603483
           cov(tenure,union) |   .0016667   .0004909      .0007044    .0026289
-----------------------------+------------------------------------------------
idcode: Unstructured         |
                   var(race) |   .0202217   .0139137      .0052498    .0778921
                  var(_cons) |   .1578058    .031278      .1070066    .2327211
             cov(race,_cons) |  -.0401861    .022046     -.0833954    .0030232
-----------------------------+------------------------------------------------
               var(Residual) |   .0583641   .0007602      .0568929    .0598732
------------------------------------------------------------------------------
LR test vs. linear model: chi2(6) = 10154.21              Prob &gt; chi2 = 0.0000

Note: LR test is conservative and provided only for reference.

------------------------------------------------------------------------------
      tenure |     Median              2.5 Percentile      97.5 Percentile
-------------+----------------------------------------------------------------
       union |   .0321253                 .0121897            .0521846
------------------------------------------------------------------------------

------------------------------------------------------------------------------
        race |     Median              2.5 Percentile      97.5 Percentile
-------------+----------------------------------------------------------------
       _cons |  -.2544331                 -.476558           -.1166022
------------------------------------------------------------------------------</code></pre>
</div>
</div>
<div id="49ae16b8" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>mixed ln_w grade age || idcode: tenure <span class="kw">union</span>, cov(uns) || idcode: race, <span class="co">///</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    cov(uns)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>reffadjustsim tenure <span class="kw">union</span>, eqn(idcode) sub(1) <span class="dv">seed</span>(12345)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>reffadjustsim race <span class="dt">_cons</span>, eqn(idcode) sub(2) <span class="dv">seed</span>(12345)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Performing EM optimization ...

Performing gradient-based optimization: 
Iteration 0:  Log likelihood = -5208.9293  
Iteration 1:  Log likelihood = -5199.2605  (not concave)
Iteration 2:  Log likelihood =   -5175.53  (not concave)
Iteration 3:  Log likelihood = -5173.8245  
Iteration 4:  Log likelihood = -5171.2707  
Iteration 5:  Log likelihood = -5171.0525  
Iteration 6:  Log likelihood = -5171.0492  
Iteration 7:  Log likelihood = -5171.0492  

Computing standard errors ...

Mixed-effects ML regression                         Number of obs    =  19,008
Group variable: idcode                              Number of groups =   4,132
                                                    Obs per group:
                                                                 min =       1
                                                                 avg =     4.6
                                                                 max =      12
                                                    Wald chi2(2)     = 2164.18
Log likelihood = -5171.0492                         Prob &gt; chi2      =  0.0000

------------------------------------------------------------------------------
     ln_wage | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
       grade |    .083625   .0022067    37.90   0.000        .0793      .08795
         age |   .0104518   .0004215    24.80   0.000     .0096256    .0112779
       _cons |   .2739857   .0306868     8.93   0.000     .2138407    .3341307
------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
idcode: Unstructured         |
                 var(tenure) |   .0007758   .0000666      .0006556    .0009181
                  var(union) |   .0514475   .0041886      .0438595    .0603483
           cov(tenure,union) |   .0016667   .0004909      .0007044    .0026289
-----------------------------+------------------------------------------------
idcode: Unstructured         |
                   var(race) |   .0202217   .0139134      .0052499      .07789
                  var(_cons) |   .1578059   .0312773      .1070075    .2327191
             cov(race,_cons) |  -.0401862   .0220455     -.0833945    .0030222
-----------------------------+------------------------------------------------
               var(Residual) |   .0583641   .0007602      .0568929    .0598732
------------------------------------------------------------------------------
LR test vs. linear model: chi2(6) = 10154.21              Prob &gt; chi2 = 0.0000

Note: LR test is conservative and provided only for reference.

------------------------------------------------------------------------------
      tenure |     Median              2.5 Percentile      97.5 Percentile
-------------+----------------------------------------------------------------
       union |   .0321253                 .0121897            .0521846
------------------------------------------------------------------------------

------------------------------------------------------------------------------
        race |     Median              2.5 Percentile      97.5 Percentile
-------------+----------------------------------------------------------------
       _cons |  -.2544335                -.4765523           -.1166046
------------------------------------------------------------------------------</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>